<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coupon List</title>
  <script>
    function selectCoupon(button) {
      const couponId = button.getAttribute('data-coupon-id');
      const discountAmount = button.getAttribute('data-discount-amount');
      const discountRate = button.getAttribute('data-discount-rate');


      window.opener.document.getElementById('selectedCoupon').value = button.getAttribute(
          'data-coupon-name');
      window.opener.document.getElementById('couponDiscount').value = discountAmount !== "null" ? discountAmount : 0;
      window.opener.document.getElementById('couponDiscountRate').value = discountRate !== "null" ? discountRate : 0;
      window.opener.document.getElementById('couponId').value = couponId;
      window.opener.updateTotalPrice();
      window.close();
    }
  </script>
</head>
<body>
<h1>Coupon List</h1>
<table>
  <thead>
  <tr>
    <th>쿠폰명</th>
    <th>할인 금액</th>
    <th>할인율</th>
    <th>최소 주문 금액</th>
    <th>쿠폰 만료 일자</th>
    <th>Action</th>
  </tr>
  </thead>
  <tbody>
  <th:block th:each="coupon : ${coupons}">
    <tr>
      <td th:text="${coupon.couponName}"></td>
      <td th:text="${coupon.couponDiscountAmount != null ? coupon.couponDiscountAmount.intValue() : '-'}"></td>
      <td th:text="${coupon.couponDiscountRate != null ? coupon.couponDiscountRate + '%' : '-'}"></td>
      <td th:text="${coupon.couponMinAmount.intValue()}"></td>
      <td th:text="${#dates.format(coupon.CouponExpiredAt, 'yyyy-MM-dd')}"></td>
      <td>
        <button type="button"
                th:attr="data-coupon-id=${coupon.userCouponId},
                        data-coupon-name=${coupon.couponName},
                        data-discount-amount=${coupon.couponDiscountAmount != null ? coupon.couponDiscountAmount.intValue() : 'null'},
                        data-discount-rate=${coupon.couponDiscountRate != null ? coupon.couponDiscountRate : 'null'}"
                onclick="selectCoupon(this)">선택</button>
      </td>
    </tr>
  </th:block>
  </tbody>
</table>
</body>
</html>
